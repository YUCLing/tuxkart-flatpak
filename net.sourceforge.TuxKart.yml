id: net.sourceforge.TuxKart
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: /app/bin/run-tuxkart
finish-args:
  - --socket=x11
  - --socket=pulseaudio
  - --device=dri
cleanup:
  - /include
  - '*.a'

modules:
  # -------------------------------------------------------------------------
  # Module 1: PLIB (Dependency)
  # TuxKart requires this library, which is essentially dead/legacy now.
  # We build it from source and install it into /app/lib and /app/include
  # -------------------------------------------------------------------------
  - name: plib
    buildsystem: autotools
    sources:
      - type: archive
        url: https://plib.sourceforge.net/dist/plib-1.8.5.tar.gz
        sha256: 485b22bf6fdc0da067e34ead5e26f002b76326f6371e2ae006415dea6a380a32
      - type: patch
        paths:
          - patches/plib-link-flags.patch
          - patches/plib-ioctl-fix.patch

  # -------------------------------------------------------------------------
  # Module 2: TuxKart (The Application)
  # -------------------------------------------------------------------------
  - name: tuxkart
    buildsystem: autotools
    sources:
      - type: archive
        url: https://tuxkart.sourceforge.net/dist/tuxkart-0.4.0.tar.gz
        sha256: 2d9048435ac558debf92d430efa55ccf15c68e1253c97648babe67437ff82c12

      - type: patch
        paths:
          - patches/tuxkart-link-flags.patch
          - patches/tuxkart-title-menu-resizing.patch
      
      - type: file
        path: net.sourceforge.TuxKart.desktop

    config-opts:
      - --prefix=/app

    post-install:
      - |
        ffmpeg -i /app/share/games/tuxkart/images/tux_icon.rgb icon.png
        install -Dm644 icon.png /app/share/icons/hicolor/64x64/apps/net.sourceforge.TuxKart.png
        install -Dm644 net.sourceforge.TuxKart.desktop /app/share/applications/net.sourceforge.TuxKart.desktop

      - |
        mkdir -p /app/bin
        echo '#!/bin/sh' > /app/bin/run-tuxkart
        echo 'exec padsp /app/games/tuxkart "$@"' >> /app/bin/run-tuxkart
        chmod +x /app/bin/run-tuxkart
